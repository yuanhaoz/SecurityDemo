# SQL 注入攻击

所谓的SQL注入，就是通过把SQL命令伪装成正常的HTTP请求参数，传递到服务端，欺骗服务器最终执行恶意的SQL命令，达到入侵目的。攻击者可以利用SQL注入漏洞，查询非授权信息，修改数据库服务器的数据，改变表结构，甚至是获取服务器root权限。总而言之，SQL注入漏洞的危害极大，攻击者采用的SQL指令决定了攻击的威力。目前涉及的大批量数据泄露的攻击事件，大部分都是通过SQL注入来实施的。

## SQL 注入的防范

（1）使用预编译语句。

预编译语句 PreparedStatement 是 java.sql 中的一个接口，继承自 Statement 接口。通过 Statement 对象执行 SQL 语句时，需要将SQL语句发送给 DBMS，由 DBMS 先进行编译后再执行。而预编译语句和Statement不同，在创建 PreparedStatement 对象时就指定了SQL语句，该语句立即发送给DBMS进行编译，当该编译语句需要被执行时，DBMS直接运行编译后的SQL语句，而不需要像其他SQL语句那样先将其编译。

（2）使用ORM框架。

由上文可见，防止SQL注入的关键在于对一些关键字符进行转义，而常见的一些ORM框架，如IBATIS、Hibernate等，都支持对相应的关键字或者特殊符号进行转义，可以通过简单的配置，很好地预防SQL注入漏洞，降低了普通的开发人员进行安全编程的门槛。

（3）避免免密码明文存放。

对存储的密码进行单向 Hash，如使用 MD5 对密码进行摘要，而非直接存储明文密码，这样的好处就是万一用户信息泄露，即圈内所说的被“拖库”（从数据库中导出数据），黑客无法直接获取用户密码，而只能得到一串跟密码相差十万八千里的Hash码。

（4）处理好相应的异常。

后台的系统异常，很可能包含了一些如服务器版本、数据库、编程语言等信息，甚至是数据库连接的地址与用户名密码，攻击者可以按图索骥，找到对应版本的服务器漏洞或者数据库漏洞进行攻击，因此，必须要处理好后台的系统异常，重定向到相应的错误处理页面，而不是任由其直接输出到页面上。