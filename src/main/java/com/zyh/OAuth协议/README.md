# OAuth 协议

前文所提到的摘要认证、签名认证和HTTPS协议，能够保障客户端与服务端在双方相互信任情况下通信的安全，但是对于下文所描述的场景来说，以上的认证方式却无能为力。

随着互联网的深入发展，一些互联网巨头逐渐累积了海量的用户和数据。对于平台级的软件厂商来说，用户需求多种多样，变化万千，以一己之力予以充分满足，难免疲于奔命，因此，将数据以接口的形式下放给众多的第三方开发者，便成了必然的趋势。第三方开发者经过二次开发，满足一小部分的用户的独特需求，即能够使自己获得利益，也能够让数据流动起来，在大平台周围形成一个良性的生态环境，最终达到用户、平台商、第三方开发者共赢。

理想是美好的，但是问题也随之而来，如何保障用户数据的安全，防止用户隐私泄露，便成为了首要的问题。平台商必须保障对于用户私有数据的访问，均是经过用户授权的合法行为，且不会对第三方泄露类似用户名和密码这样的核心数据。

在这样的背景下，诞生了 OAuth 协议。

## OAuth 的介绍

OAuthor协议主要是为用户资源的授权访问提供一个安全、开放的标准。平台商通过 OAuth 协议，提示用户对第三方软件厂商（ISV）进行授权，使得第三方软件厂商能够使用平台商的部分数据，对用户提供服务，如下图所示。与以往的授权方式不同，OAuth 协议并不需要触及用户的账户信息，即用户名密码，便可以完成第三方对用户信息访问的授权。

![Image text](https://github.com/yuanhaoz/SecurityDemo/blob/develop/src/main/java/com/zyh/OAuth协议/OAuth1.png)

用户通过平台商对第三方应用进行授权，而第三方应用得到授权后，便可以在一定的时间内，通过平台商提供的接口，访问到用户授权的信息，为用户提供服务。

正是由于OAuth协议平衡了ISV、平台商、用户三者间的诉求，很多大型互联网企业，如Google、Yahoo!、Facebook、Microsoft等，都通过OAuth协议对外开放了其所拥有的海量数据，繁荣了整个互联网生态圈，与此同时，也使得OAuth协议正逐渐成为开放资源授权的标准协议。

## OAuth 授权过程

OAuth 发展到目前为止，一共经历了 OAuth1.0、OAuth1.0a、OAuth2.0等几个版本，其核心思想都是将资源做权限分级和隔离，ISV引导用户在平台端登录，完成授权。获得授权后ISV可以在一定时间段内访问用户的私有数据，用户可以完全把控这一过程，且授权可取消。这样第三方ISV能够利用平台商所拥有的一些数据来服务用户，为用户创造价值，形成了一个生态系统的闭环。

要获得OAuth协议授权，首先需要第三方开发者向平台商申请应用ID，即appId，对自己的APP进行注册。一次OAuth对ISV授权数据访问过程如下图所示，包含了如下几个步骤：

![Image text](https://github.com/yuanhaoz/SecurityDemo/blob/develop/src/main/java/com/zyh/OAuth协议/OAuth2.png)

```markdown
(1) 用户先对ISV的应用进行访问，发起请求。
(2) ISV收到用户请求后，再向平台商请求 request token，并带上其申请的appleId。
(3) 平台将返回给第三方应用 request token。
(4) ISV 应用将用户引导到平台的授权页面，并带上自己的appleId、request token 和回调地址。
(5) 用户在平台的页面上进行登录，并且完成授权（这样便不会将用户名密码赤裸裸地暴露给第三方）。
(6) 平台通过ISV提供的回调链接，返回给ISV应用access token。
(7) ISV应用通过access token取到用户授权的数据，进行加工后返回给用户，授权数据访问完成。
```

通常情况下，OAuth在进行协议授权和数据传输时，包含的都是敏感度较高的内容，为了确保通信安全，一般会包含如前文所述的认证过程，如摘要认证、签名认证、HTTPS等。